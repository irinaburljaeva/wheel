<!doctype html>

<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>–ö–æ–ª–µ—Å–æ —Å—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏ ‚Äî –º–∏–Ω–∏‚Äë–∏–≥—Ä–∞</title>
  <meta name="color-scheme" content="light only"/>
  <style>
    :root{
      /* –ë—Ä–µ–Ω–¥–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ –®–ê–ì–ê–ô –î–û–ú–ê */
      --r:#CF2C02; /* –∫–æ—Ä–∞–ª–ª–æ–≤–æ‚Äë–∫—Ä–∞—Å–Ω—ã–π */
      --y:#FFBA08; /* —è—Ä–∫–æ‚Äë–∂—ë–ª—Ç—ã–π */
      --o:#E85D04; /* –æ—Ä–∞–Ω–∂–µ–≤—ã–π */
      --g:#D9D9D9; /* —Å–≤–µ—Ç–ª–æ‚Äë—Å–µ—Ä—ã–π */
      --txt:#1a1a1a;
      --ok:#18a957;
      --err:#c02626;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Color Emoji", "Apple Color Emoji";
      color:var(--txt); background:linear-gradient(180deg,#fff, #fff8e1 35%, #fff3d1);
      display:flex; align-items:center; justify-content:center;
    }
    .app{width:min(920px,96vw); padding:24px; position:relative}/* –õ–û–ì–û –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É */
.logo{position:absolute; top:16px; right:16px; width:min(20vw,120px); aspect-ratio:1/1; z-index:10;}
.logo img{width:100%; height:100%; object-fit:contain; filter: drop-shadow(0 2px 6px rgba(0,0,0,.08));}

.card{
  background:#fff; border:1px solid #fff1c1; border-radius:20px; padding:18px;
  box-shadow:0 6px 22px rgba(0,0,0,.06);
}

.title{font-weight:800; font-size:clamp(22px,4vw,32px); letter-spacing:0.2px;}
.subtitle{margin-top:4px; color:#444; font-size:clamp(14px,2.5vw,16px)}

.playground{display:grid; grid-template-columns: 1fr; gap:16px; margin-top:16px}
@media (min-width:840px){ .playground{grid-template-columns: 1.1fr .9fr} }

.wheel-wrap{display:grid; place-items:center; padding:10px}
.wheel-box{position:relative; width:min(72vw,420px); aspect-ratio:1/1;}

/* –ö–û–õ–ï–°–û –° –°–ï–ì–ú–ï–ù–¢–ê–ú–ò –ò –ò–ö–û–ù–ö–ê–ú–ò */
.wheel{
  position:absolute; inset:0; border-radius:50%;
  /* 12 —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –ø–æ 30¬∞: —á–µ—Ä–µ–¥—É–µ–º —Ü–≤–µ—Ç–∞ –±—Ä–µ–Ω–¥–∞ */
  background:
    conic-gradient(
      from -15deg,
      var(--y) 0deg 30deg,
      var(--o) 30deg 60deg,
      var(--y) 60deg 90deg,
      var(--o) 90deg 120deg,
      var(--y) 120deg 150deg,
      var(--o) 150deg 180deg,
      var(--y) 180deg 210deg,
      var(--o) 210deg 240deg,
      var(--y) 240deg 270deg,
      var(--o) 270deg 300deg,
      var(--y) 300deg 330deg,
      var(--o) 330deg 360deg
    );
  border:8px solid #fff; box-shadow: inset 0 0 0 10px rgba(0,0,0,.04), 0 8px 24px rgba(0,0,0,.08);
  --spin: 0deg; /* —Ç–µ–∫—É—â–∏–π —É–≥–æ–ª –≤—Ä–∞—â–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç—Ä‚Äë–ø–æ–≤–æ—Ä–æ—Ç–∞ –∏–∫–æ–Ω–æ–∫ */
  --R: 0px;     /* —Ä–∞–¥–∏—É—Å –≤—ã–∫–ª–∞–¥–∫–∏ –∏–∫–æ–Ω–æ–∫ (–∑–∞–¥–∞—ë–º –∏–∑ JS) */
}

.wheel::after{
  /* —Ü–µ–Ω—Ç—Ä */
  content:""; position:absolute; inset:0; margin:auto; width:22%; aspect-ratio:1/1; border-radius:50%;
  background:radial-gradient(#fff, #ffe6a8 55%, #ffd66d);
  border:4px solid #fff; box-shadow:0 4px 12px rgba(0,0,0,.15);
}

/* –£–∫–∞–∑–∞—Ç–µ–ª—å —Å–≤–µ—Ä—Ö—É */
.pointer{
  position:absolute; top:-10px; left:50%; transform:translateX(-50%);
  width:0; height:0; border-left:14px solid transparent; border-right:14px solid transparent; border-bottom:20px solid var(--r);
  filter: drop-shadow(0 4px 6px rgba(0,0,0,.18));
  z-index:5;
}

/* –°–ª–æ—Ç—ã —Å –∏–∫–æ–Ω–∫–∞–º–∏ –≤–æ–∫—Ä—É–≥ –∫–æ–ª–µ—Å–∞ */
.slot{ position:absolute; inset:0; transform-origin:50% 50%; }
.slot img{
  position:absolute; left:50%; top:50%;
  width:min(14vw,76px); height:auto; object-fit:contain;
  /* 1) —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º, 2) –≤—ã–Ω–æ—Å–∏–º –∫ –∫—Ä–∞—é –ø–æ —Ä–∞–¥–∏—É—Å—É, 3) –∫–æ–Ω—Ç—Ä‚Äë–ø–æ–≤–æ—Ä–æ—Ç, —á—Ç–æ–±—ã –∏–∫–æ–Ω–∫–∞ –Ω–µ –∫—Ä—É—Ç–∏–ª–∞—Å—å */
  transform: translate(-50%, -50%) rotate(var(--deg)) translate(0, calc(-1 * var(--R))) rotate(calc(-1 * var(--spin)));
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.12));
}

.controls{display:grid; gap:10px; margin-top:8px}
.msg{min-height:44px; display:flex; align-items:center; justify-content:center; text-align:center; padding:8px 12px; border-radius:12px; background:#fff8d8; border:1px solid #ffe5a3}
.msg b{color:var(--o)}
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:10px; cursor:pointer; user-select:none;
  background:linear-gradient(180deg, var(--y), #ffc43a 40%, #ffb60f);
  color:#3a2a00; font-weight:800; letter-spacing:.3px; text-transform:uppercase; padding:14px 18px;
  border:0; border-radius:999px; box-shadow: 0 10px 18px rgba(233,147,0,.28), 0 3px 0 #eaa200 inset;
  transition: transform .08s ease;
}
.btn:active{ transform: translateY(1px) }
.btn[disabled]{ opacity:.55; cursor:not-allowed }

.result{display:grid; gap:12px}
.result .thumb{ width:min(56vw,280px); aspect-ratio:1/1; border-radius:18px; border:8px solid #fff; box-shadow:0 6px 22px rgba(0,0,0,.12); overflow:hidden; background:#fff; display:grid; place-items:center}
.result .thumb img{ width:100%; height:100%; object-fit:contain; }
.result .text{ font-size:clamp(15px,2.7vw,18px); }

.amulet-bar{
  margin-top:6px; display:flex; align-items:center; gap:12px; padding:10px 12px; border-radius:14px; background:#fff; border:1px dashed #ffd27a
}
.amulet{ width:48px; height:48px; border-radius:12px; background:#fff; border:1px solid #ffe5a3; display:grid; place-items:center; overflow:hidden }
.amulet img{ width:80%; height:80%; object-fit:contain; filter: drop-shadow(0 2px 2px rgba(0,0,0,.08)); }
.amulet.locked img{ filter: grayscale(.92) opacity(.5) }
.ok{ color:var(--ok); font-weight:700 }
.err{ color:var(--err); font-weight:700 }

.hint{ font-size:12px; color:#666; }

.toast{ position:fixed; bottom:18px; left:50%; transform:translateX(-50%); padding:10px 14px; border-radius:12px; background: #101010; color:#fff; box-shadow: 0 12px 24px rgba(0,0,0,.25); opacity:0; pointer-events:none; transition: opacity .25s ease }
.toast.show{ opacity:1 }

  </style>
</head>
<body>
  <div class="app">
    <!-- –õ–û–ì–û -->
    <div class="logo" aria-label="–õ–æ–≥–æ—Ç–∏–ø">
      <img src="logo.png" alt="–®–ê–ì–ê–ô –î–û–ú–ê ‚Äî –ª–æ–≥–æ—Ç–∏–ø"/>
    </div><div class="card">
  <div class="title">–ö–æ–ª–µ—Å–æ —Å—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏</div>
  <div class="subtitle">–í—Ä–∞—â–∞–π—Ç–µ –∫–æ–ª–µ—Å–æ. <b>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞ —Å—ä–µ–¥–æ–±–Ω–æ–º</b> ‚Äî –∏ –ø–æ–ª—É—á–∏—Ç–µ –∞–º—É–ª–µ—Ç!</div>

  <div class="playground">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–æ–ª–µ—Å–æ -->
    <div class="wheel-wrap">
      <div class="wheel-box">
        <div id="pointer" class="pointer" aria-hidden="true"></div>
        <div id="wheel" class="wheel" aria-hidden="true"></div>
      </div>

      <div class="controls">
        <div id="msg" class="msg">–ù–∞–∂–º–∏—Ç–µ ¬´–í—Ä–∞—â–∞—Ç—å¬ª, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ —É–¥–∞—á–∏.</div>
        <button id="btn" class="btn">–í—Ä–∞—â–∞—Ç—å</button>
        <div class="hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å—ä–µ–¥–æ–±–Ω–æ–µ ‚Äî —ç—Ç–æ <b>–∫—É—Ä–æ—á–∫–∞</b> üçó</div>
      </div>

      <div class="amulet-bar">
        <div id="amuletCell" class="amulet locked"><img src="amulet.png" alt="–∞–º—É–ª–µ—Ç"></div>
        <div>
          <div id="amuletStatus">–ê–º—É–ª–µ—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –µ—â—ë <span class="err">–Ω–µ –ø–æ–ª—É—á–µ–Ω</span>.</div>
          <div id="amuletHint" class="hint">–ü–æ–π–º–∞–π—Ç–µ —Å—ä–µ–¥–æ–±–Ω–æ–µ ‚Äî –∏ –∞–º—É–ª–µ—Ç –±—É–¥–µ—Ç –≤–∞—à. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 1 –≤ –¥–µ–Ω—å.</div>
        </div>
      </div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div class="result">
      <div class="thumb" id="resultThumb" aria-live="polite" aria-atomic="true">
        <img id="resultImg" alt="–†–µ–∑—É–ª—å—Ç–∞—Ç" src="" style="display:none"/>
        <div id="thumbPlaceholder" style="opacity:.6; font-weight:700; text-align:center; padding:20px;">
          –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å
        </div>
      </div>
      <div id="resultText" class="text"></div>
    </div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

  </div>  <script>
    /* =====================
       –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
    ======================*/
    const UNSAFE = [
      'bug.png','bug1.png','bug2.png','bug3.png','bug4.png','bug5.png','bug6.png','bug7.png','bug8.png','bug9.png','burger.png'
    ];
    const SAFE = ['chicken.png'];
    const ORDER = [...UNSAFE, ...SAFE]; // 12 —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (11 –Ω–µ—Å—ä–µ–¥–æ–±–Ω—ã—Ö + 1 —Å—ä–µ–¥–æ–±–Ω—ã–π)
    let layout = [...ORDER]; // —Ç–µ–∫—É—â–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ (–ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞—É–Ω–¥)

    const MESSAGES = {
      start: '–ù–∞–∂–º–∏—Ç–µ ¬´–í—Ä–∞—â–∞—Ç—å¬ª, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ —É–¥–∞—á–∏.',
      stopCall: '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–ª–µ—Å–æ –Ω–∞ <b>—Å—ä–µ–¥–æ–±–Ω–æ–º</b>, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∞–º—É–ª–µ—Ç!',
      thinking: '–ö–æ–ª–µ—Å–æ –∫—Ä—É—Ç–∏—Ç—Å—è‚Ä¶',
      stopped: '–ö–æ–ª–µ—Å–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –°–º–æ—Ç—Ä–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç‚Ä¶'
    };

    /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∞–º—É–ª–µ—Ç–∞: 1 –≤ –¥–µ–Ω—å (–ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∞—Ç–µ) */
    const LS_KEY = 'sd_amulet_claimed_on_v1';
    const todayStr = () => new Date().toLocaleDateString('sv-SE'); // YYYY-MM-DD

    function amuletClaimedToday(){
      try{ return localStorage.getItem(LS_KEY) === todayStr(); }catch(e){ return false }
    }
    function setAmuletClaimed(){
      try{ localStorage.setItem(LS_KEY, todayStr()); }catch(e){}
    }

    /* =====================
       DOM —Å—Å—ã–ª–∫–∏
    ======================*/
    const wheel = document.getElementById('wheel');
    const btn = document.getElementById('btn');
    const msg = document.getElementById('msg');
    const resultImg = document.getElementById('resultImg');
    const resultText = document.getElementById('resultText');
    const thumbPh = document.getElementById('thumbPlaceholder');
    const amuletCell = document.getElementById('amuletCell');
    const amuletStatus = document.getElementById('amuletStatus');
    const amuletHint = document.getElementById('amuletHint');
    const toast = document.getElementById('toast');

    /* =====================
       –°—Ç–µ–π—Ç-–º–∞—à–∏–Ω–∞
    ======================*/
    const STATE = { IDLE:'IDLE', SPINNING:'SPINNING', WAITING_STOP:'WAITING_STOP', RESULT:'RESULT'};
    let state = STATE.IDLE;

    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∏–º–∞—Ü–∏–∏
    let rafId = 0; let angle = 0; let speed = 0; // deg/s

    function setState(newState){ state = newState; }
    function setMsg(html){ msg.innerHTML = html; }
    function showToast(text, ms=1600){
      toast.textContent = text; toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), ms);
    }

    function updateAmuletBar(){
      if (amuletClaimedToday()){
        amuletCell.classList.remove('locked');
        amuletStatus.innerHTML = '–ê–º—É–ª–µ—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è —É–∂–µ <span class="ok">–ø–æ–ª—É—á–µ–Ω</span>!';
        amuletHint.textContent = `–ú–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –¥–∞–ª—å—à–µ –¥–ª—è —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è. –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∑–∞–≤—Ç—Ä–∞ –∑–∞ –Ω–æ–≤—ã–º –∞–º—É–ª–µ—Ç–æ–º.`;
      } else {
        amuletCell.classList.add('locked');
        amuletStatus.innerHTML = '–ê–º—É–ª–µ—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –µ—â—ë <span class="err">–Ω–µ –ø–æ–ª—É—á–µ–Ω</span>.';
        amuletHint.textContent = '–ü–æ–π–º–∞–π—Ç–µ —Å—ä–µ–¥–æ–±–Ω–æ–µ ‚Äî –∏ –∞–º—É–ª–µ—Ç –±—É–¥–µ—Ç –≤–∞—à. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: 1 –≤ –¥–µ–Ω—å.';
      }
    }

    function preloadImages(paths){ paths.forEach(src=>{ const im=new Image(); im.src=src; }); }
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

    /* –†–∏—Å—É–µ–º –∏–∫–æ–Ω–∫–∏ –ø–æ –∫—Ä—É–≥—É ‚Äî —Å—Ä–∞–∑—É –≤–∏–¥–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é */
    function buildSlots(){
      // —Ä–∞–¥–∏—É—Å –≤—ã–∫–ª–∞–¥–∫–∏ = 38% –æ—Ç –¥–∏–∞–º–µ—Ç—Ä–∞
      const size = wheel.offsetWidth || 360;
      const R = Math.round(size * 0.38);
      wheel.style.setProperty('--R', R + 'px');

      // –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–ª–æ—Ç—ã (–µ—Å–ª–∏ —Ä–µ—Å–∞–π–∑)
      [...wheel.querySelectorAll('.slot')].forEach(n=>n.remove());

      layout.forEach((file, i)=>{
        const slot = document.createElement('div');
        slot.className = 'slot';
        slot.style.setProperty('--deg', (i*30) + 'deg'); // 12 —Å–µ–≥–º–µ–Ω—Ç–æ–≤

        const img = document.createElement('img');
        img.src = file; img.alt = file.replace('.png','');
        slot.appendChild(img);
        wheel.appendChild(slot);
      });
    }

    function startSpin(){
      if (state !== STATE.IDLE && state !== STATE.RESULT) return;
      // –Ω–æ–≤–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ä–∞—É–Ω–¥–æ–º
      layout = shuffle([...ORDER]);
      buildSlots();
      angle = 0; applyWheelRotation();
      // —Å–±—Ä–æ—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      resultImg.style.display='none'; resultImg.removeAttribute('src'); resultText.textContent=''; thumbPh.style.display='grid';
      // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
      speed = 720; // deg / sec
      setState(STATE.SPINNING);
      btn.disabled = true; btn.textContent = '–ö—Ä—É—Ç–∏—Ç—Å—è‚Ä¶'; setMsg(MESSAGES.thinking);
      // –ø–ª–∞–≤–Ω—ã–π —Ä–∞–∑–≥–æ–Ω –∏ –ø–æ–∫–∞–∑ –ø–æ–¥—Å–∫–∞–∑–∫–∏ ¬´–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ‚Ä¶¬ª
      setTimeout(()=>{
        setState(STATE.WAITING_STOP);
        btn.disabled = false; btn.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å'; setMsg(MESSAGES.stopCall);
      }, 900);
      spinLoop();
    }

    function spinLoop(){
      let last = performance.now();
      cancelAnimationFrame(rafId);
      function frame(now){
        const dt = (now - last)/1000; last = now;
        angle = (angle + speed * dt) % 360;
        applyWheelRotation();
        // –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ª—ë–≥–∫–æ–µ –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ
        if (state === STATE.SPINNING) speed = Math.max(360, speed - 100*dt); // –¥–æ 360 deg/s
        rafId = requestAnimationFrame(frame);
      }
      rafId = requestAnimationFrame(frame);
    }

    function applyWheelRotation(){
      wheel.style.transform = `rotate(${angle}deg)`;
      wheel.style.setProperty('--spin', angle + 'deg'); // –¥–ª—è –∫–æ–Ω—Ç—Ä‚Äë–ø–æ–≤–æ—Ä–æ—Ç–∞ –∏–∫–æ–Ω–æ–∫
    }

    function stopSpinAndResolve(){
      if (state !== STATE.WAITING_STOP) return;
      setState(STATE.RESULT);
      btn.disabled = true; btn.textContent = '–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º‚Ä¶'; setMsg(MESSAGES.stopped);

      // –í—ã–±–æ—Ä —Ü–µ–ª–µ–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –≤–µ—Å–∞–º–∏: 20% –∫—É—Ä–æ—á–∫–∞, 80% –ª—é–±–æ–π –Ω–µ—Å—ä–µ–¥–æ–±–Ω—ã–π
      const pickFile = (Math.random() < 0.20) ? 'chicken.png' : UNSAFE[Math.floor(Math.random()*UNSAFE.length)];
      const targetIndex = layout.indexOf(pickFile);

      // —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–Ω–µ—á–Ω—ã–π —É–≥–æ–ª —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ–¥ —É–∫–∞–∑–∞—Ç–µ–ª–µ–º –æ–∫–∞–∑–∞–ª—Å—è —Ü–µ–Ω—Ç—Ä —Ü–µ–ª–µ–≤–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞
      const current = angle;
      const currentDeg = ((current % 360)+360)%360;
      const centerDeg = (360 - (targetIndex*30)) % 360;
      const deltaToCenter = (centerDeg - currentDeg + 360) % 360;
      const extraSpins = 720; // +2 –æ–±–æ—Ä–æ—Ç–∞ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
      const finalAngle = current + extraSpins + deltaToCenter;

      cancelAnimationFrame(rafId);
      const t0 = performance.now();
      const duration = 1200;
      function easeOutCubic(x){ return 1 - Math.pow(1 - x, 3) }
      function frame(now){
        const p = Math.min(1, (now - t0)/duration);
        const eased = easeOutCubic(p);
        angle = current + (finalAngle - current) * eased;
        applyWheelRotation();
        if (p < 1){ requestAnimationFrame(frame); } else { onForcedStopResult(pickFile); }
      }
      requestAnimationFrame(frame);
    }

    function onForcedStopResult(file){
      // –≤–∏–±—Ä–∞—Ü–∏—è –∏ –∑–≤—É–∫ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
      try{ if (navigator.vibrate) navigator.vibrate(60); }catch(e){}
      try{ new Audio('stop.mp3').play().catch(()=>{}); }catch(e){}

      showResult(file);
      btn.disabled = false; btn.textContent = '–°—ã–≥—Ä–∞—Ç—å –µ—â—ë'; setMsg(MESSAGES.start);
      setState(STATE.RESULT);
    }

    function angleToIndex(a){
      const deg = ((a % 360) + 360) % 360;
      const idx = Math.floor((((360 - deg) + 15) % 360) / 30);
      return idx; // 0..11
    }

    function showResult(file){
      thumbPh.style.display='none';
      resultImg.src = file; resultImg.alt = '–í—ã–ø–∞–ª–æ: ' + file; resultImg.style.display='block';

      if (file === 'burger.png'){
        resultText.innerHTML = '<b style="color:var(--err)">–û–π!</b> –®–∞–º–∞–Ω –ì–∞–ª–∏–Ω–∞ —É–≤–∏–¥–µ–ª–∞ –≤–∞—à –æ—Ç–≤–µ—Ç –∏ —Å–∏–ª—å–Ω–æ —Ä–∞–∑–æ–∑–ª–∏–ª–∞—Å—å!<br>–ù–µ—Ç‚Äë–Ω–µ—Ç. –¢–∞–∫–æ–µ –º—ã –Ω–∞ –Ω–∞—à–µ–º –æ—Å—Ç—Ä–æ–≤–µ —Å—Ç—Ä–æ–π–Ω–æ—Å—Ç–∏ –Ω–µ –µ–¥–∏–º!';
        showToast('–ë—É—Ä–≥–µ—Ä ‚Äî –Ω–µ—Å—ä–µ–¥–æ–±–Ω–æ–µ –¥–ª—è –æ—Å—Ç—Ä–æ–≤–∞');
      } else if (file === 'chicken.png'){
        if (!amuletClaimedToday()){
          setAmuletClaimed();
          updateAmuletBar();
          resultText.innerHTML = '<b class="ok">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</b> –≠—Ç–æ —Å—ä–µ–¥–æ–±–Ω–æ–µ. –ê–º—É–ª–µ—Ç –≤–∞—à!';
          pulseAmulet();
          confettiLite();
          try{ if (navigator.vibrate) navigator.vibrate([30,40,30]); }catch(e){}
          try{ new Audio('win.mp3').play().catch(()=>{}); }catch(e){}
        } else {
          resultText.innerHTML = '–≠—Ç–æ —Å—ä–µ–¥–æ–±–Ω–æ–µ, –Ω–æ –ª–∏–º–∏—Ç –∞–º—É–ª–µ—Ç–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è —É–∂–µ –∏—Å—á–µ—Ä–ø–∞–Ω. –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞–≤—Ç—Ä–∞!';
          showToast('–ê–º—É–ª–µ—Ç —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è');
        }
      } else {
        resultText.textContent = '–ù–µ—Å—ä–µ–¥–æ–±–Ω–æ–µ‚Ä¶ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑!';
        showToast('–£–≤—ã, –Ω–µ —Å—ä–µ–¥–æ–±–Ω–æ–µ');
      }
    }

    function pulseAmulet(){
      amuletCell.animate([
        { transform:'scale(1)', filter:'drop-shadow(0 0 0 rgba(0,0,0,0))' },
        { transform:'scale(1.12)', filter:'drop-shadow(0 8px 16px rgba(0,0,0,.18))' },
        { transform:'scale(1)' }
      ], { duration:700, easing:'cubic-bezier(.2,.9,.2,1)' });
    }

    /* –ú–∏–Ω–∏‚Äë–∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π */
    function confettiLite(){
      const n = 18; const box = document.body; const frags = [];
      for (let i=0;i<n;i++){
        const s = document.createElement('span');
        s.style.cssText = `position:fixed; width:8px; height:12px; left:${50+ (Math.random()*20-10)}vw; top:10vh; background:${i%2? 'var(--y)':'var(--o)'}; transform: rotate(${Math.random()*360}deg); border-radius:2px; z-index:9999;`;
        box.appendChild(s); frags.push(s);
        const dx = (Math.random()*2-1)*30; const dy = 60 + Math.random()*40; const rt = (Math.random()*2-1)*360;
        s.animate([
          { transform:`translate(0,0) rotate(0deg)`, opacity:1 },
          { transform:`translate(${dx}vw, ${dy}vh) rotate(${rt}deg)`, opacity:0 }
        ], { duration:1200 + Math.random()*600, easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish = ()=> s.remove();
      }
    }

    /* –ö–Ω–æ–ø–∫–∞: –¥–≤–∞ —à–∞–≥–∞ ‚Äî –∫—Ä—É—Ç–∏—Ç—å ‚Üí –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å */
    btn.addEventListener('click', ()=>{
      if (state === STATE.IDLE || state === STATE.RESULT){ startSpin(); return; }
      if (state === STATE.SPINNING || state === STATE.WAITING_STOP){ stopSpinAndResolve(); return; }
    });

    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Enter/Space
    document.addEventListener('keydown',(e)=>{
      if (e.code==='Space' || e.code==='Enter'){ e.preventDefault(); btn.click(); }
    });

    // –ü—Ä–∏ —Ä–µ—Å–∞–π–∑–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–¥–∏—É—Å –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ª–æ—Ç—ã
    window.addEventListener('resize', ()=>{ buildSlots(); });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    (function init(){
      setMsg(MESSAGES.start);
      updateAmuletBar();
      preloadImages(['amulet.png','logo.png', ...ORDER, 'stop.mp3', 'win.mp3']);
      buildSlots();
    })();
  </script></body>
</html>
